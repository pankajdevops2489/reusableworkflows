pipeline {
    agent none
    stages {
        stage('Determine Agent') {
            agent { label 'aws-dev' } // temporary node for checkout
            steps {
                checkout scm
                script {
                    env.AGENT_LABEL = (env.GIT_BRANCH == 'origin/main') ? 'aws' : 'aws-dev'
                    echo "Branch ${env.GIT_BRANCH}, next stage will run on ${env.AGENT_LABEL}"
                    simpleName = env.JOB_NAME.split('/')[-1]
                    echo "Simple Pipeline Name: ${simpleName}"
                }
            }
        }

        stage('Hello') {
            agent { label "${env.AGENT_LABEL}" }
            steps {
                echo "Running on ${env.AGENT_LABEL}"
                echo 'Hello World'
                simpleName = env.JOB_NAME.split('/')[-1]
                echo "Simple Pipeline Name: ${simpleName}"
            }
        }
    }
}
